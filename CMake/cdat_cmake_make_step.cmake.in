
set(ENV${CC} "@CMAKE_C_COMPILER@")
set(ENV${CXX} "@CMAKE_CXX_COMPILER@")
set(ENV${CPP} "@CMAKE_CXX_COMPILER@")

set(ENV{@LIBRARY_PATH@} "@cdat_BINARY_DIR@/Externals/lib:$ENV{@LIBRARY_PATH@}")
set(ENV{LDFLAGS} "-L@cdat_BINARY_DIR@/Externals/NetCDF/lib -L@cdat_BINARY_DIR@/Externals/lib")
set(ENV{CFLAGS} "@cdat_osx_flags@ -I@cdat_BINARY_DIR@/Externals/NetCDF/include -I@cdat_BINARY_DIR@/Externals/include ${ADDITIONAL_CFLAGS}")
set(ENV{CPPFLAGS} "@cdat_osx_flags@ -I@cdat_BINARY_DIR@/Externals/NetCDF/include -I@cdat_BINARY_DIR@/Externals/include ${ADDITIONAL_CPPFLAGS}")
set(ENV{CXXFLAGS} "@cdat_osx_flags@ -I@cdat_BINARY_DIR@/Externals/NetCDF/include -I@cdat_BINARY_DIR@/Externals/include ${ADDITIONAL_CXXFLAGS}")
set(ENV{PKG_CONFIG_PATH} "@cdat_BINARY_DIR@/Externals/lib/pkgconfig")
set(ENV{PKG_CONFIG} "@cdat_PKG_CONFIG_EXECUTABLE@")
set(ENV{PYTHON_PATH} "@cdat_BINARY_DIR@/lib/python@PYTHON_MAJOR@.@PYTHON_MINOR@/site-packages:$ENV{PYTHON_PATH}")
set(ENV{FC}="")
set(ENV{FCFLAGS}="")
set(ENV{FCLIBS}="")
set(ENV{F77}="")
set(ENV{FFLAGS}="")
set(ENV{FLIBS}="")
set(ENV{LD_X11}="") # for xgks

set(ENV{EXTERNALS "@cdat_BINARY_DIR@/Externals")


message("WORKING DIR: ${WORKING_DIR}")
message("MAKE COMMAND: ${make}")

execute_process(
  COMMAND ${make}
  WORKING_DIRECTORY "${WORKING_DIR}"
  RESULT_VARIABLE res)

if(NOT ${res} EQUAL 0)
  message("Make Errors detected: \n${CDAT_OUT}\n${CDAT_ERR}")
  message(FATAL_ERROR "Error in Make")
endif()
message("Make succeeded.")

